# 第三部分：学习Shell与Shell Script

## 第9章：Vim程序编辑器

注：CentOS 8中一般账户可以使用vi或vim来编辑文件，无需再输入绝对路径/bin/vi

vim模式：一般命令模式（进入后默认处于的模式）、编辑模式、命令行模式

### 一、按键说明

#### 第一部分：一般命令模式可用的功能按键说明

- **移动光标的方法**

  | 按键                               | 效果                               |
  | ---------------------------------- | ---------------------------------- |
  | h或⬅                               | 光标左移一个字符                   |
  | j或⬇                               | 光标向下移动一个字符               |
  | k或⬆                               | 光标上移一个字符                   |
  | l或➡                               | 光标右移一个字符                   |
  | 数字+上述按键（如**`3` `0` `⬇`**） | 光标移动数个字符（下移30个字符）   |
  | **`Ctrl`** + **`f`**               | 向下移动一页                       |
  | **`Ctrl`** + **`b`**               | 向上移动一页                       |
  | **`Ctrl`** + **`d`**               | 向下移动半页                       |
  | **`Ctrl`** + **`u`**               | 向上移动半页                       |
  | +                                  | 光标移动到非空格符的下一行         |
  | -                                  | 光标移动到非空格符的上一行         |
  | n **`[Space]`**                    | 光标向右移动n个字符                |
  | 0或**`[Home]`**                    | 0是数字，移动到该行最前面的字符处  |
  | $或**`[End]`**                     | 移动到改行最后面的字符处           |
  | H                                  | 移动到屏幕最上方一行第一个字符     |
  | M                                  | 光标移动到屏幕中央一行的第一个字符 |
  | L                                  | 光标移动到屏幕最下方一行第一个字符 |
  | G                                  | 移动到文件的最后一行               |
  | nG                                 | n作为数字，移动到这个文件的第n行   |
  | gg                                 | 移动到这个文件的第一行，相当于1G   |
  | n**`[Enter]`**                     | n为数字，光标向下移动n行           |

- **查找与替换**

  | 命令                  | 效果                                                         |
  | --------------------- | ------------------------------------------------------------ |
  | /word                 | 向光标之下寻找字符串word                                     |
  | ?word                 | 向光标之上寻找字符串word                                     |
  | n                     | 重复前一个查找的操作                                         |
  | N                     | 反向重复前一个查找的操作                                     |
  | :n1,n2s/word1/word2/g | 在第n1，n2行之间寻找字符串word1                              |
  | :1,$s/word1/word2/g   | 从第一行到最后一行寻找字符串word1，并替换为word2             |
  | :1,$s/word1/word2/gc  | 从第一行到最后一行寻找字符串word1，并替换为word2，替换前显示提示字符让用户确认是否替换 |

- **删除、复制与粘贴**

  | 按键                 | 效果                                          |
  | -------------------- | --------------------------------------------- |
  | x与X                 | x向后删除一个字符，X向前删除一个字符          |
  | nx                   | 连续向后删除n个字符                           |
  | dd                   | 删除（剪切）光标所在的一整行                  |
  | ndd                  | 删除（剪切）光标所在的向下n行                 |
  | d1G                  | 删除（剪切）光标到第一行的全部数据            |
  | dG                   | 删除（剪切）光标到最后一行的所有数据          |
  | d$                   | 删除（剪切）光标到改行最后一个字符            |
  | d0                   | 0是数字，删除（剪切）光标到所在行的第一个字符 |
  | yy                   | 复制光标所在行                                |
  | nyy                  | 复制光标所在向下n行                           |
  | y1G                  | 复制光标所在行到第一行的所有数据              |
  | yG                   | 复制光标所在行到最后一行的所有数据            |
  | y0                   | 复制光标所在的字符到该行行首的所有数据        |
  | y$                   | 复制光标所在字符到该行行尾的所有数据          |
  | p与P                 | p将已复制的数据在光标下一行粘贴，P在上一行    |
  | J                    | 将光标所在行与下一行数据结合成同一行          |
  | c                    | 重复删除多个数据，如乡下删除10行输入10cj      |
  | u                    | 恢复前一个操作                                |
  | **`Ctrl`** + **`r`** | 重做上一个操作                                |
  | **`.`**              | 小数点，重复上一个操作                        |

#### 第二部分：一般命令模式切换到编辑模式可用的按键

- **进入插入或替换的编辑模式**

  | 按键 | 作用                                                         |
  | ---- | ------------------------------------------------------------ |
  | i与I | 进入插入模式（Insert mode）:<br />i从目前光标所在处插入，I从目前所在行的第一个非空格符处开始插入 |
  | a与A | 进入插入模式：<br />a为从目前光标所在的下一个字符处开始插入，A为从光标所在行的最后一个字符处开始插入 |
  | o与O | 进入插入模式：<br />o为在目前光标所在的下一行处插入新的一行，O为在光标上一行插入新的一行 |
  | r与R | 进入替换模式：<br />r仅替换一次，R则会一直替换光标所在位置的字符，直到按下Esc为止 |

#### 第三部分：一般命令模式切换到命令行模式的可用按键

- **保存和退出命令**

  | 按键                | 效果                                                         |
  | ------------------- | ------------------------------------------------------------ |
  | :w                  | 将编辑的数据写入硬盘文件中                                   |
  | :w!                 | 尝试强行写入数据，写入是否成功与当前用户对文件的权限有关     |
  | :q                  | 退出vi                                                       |
  | :q！                | 强制退出不保存                                               |
  | :wq                 | 保存后退出，若为:wq!则为强制保存后退出                       |
  | ZZ                  | 若文件未被修改，则不保存退出，若文件已经被修改过，则保存后退出 |
  | :w [filename]       | 将编辑的数据另存为另一个文件                                 |
  | :r [filename]       | 在编辑的数据中将另一个文件的数据读入到光标后面               |
  | :n1,n2 w [filename] | 将n1到n2的内容保存为filename                                 |
  | :! command          | 暂时退出vi到命令行模式执行command的显示结果（如`:! ls /home`即可在vi中查看/home下的ls信息） |
  | :set nu             | 显示行号                                                     |
  | :set nonu           | 取消显示行号                                                 |

#### 第四部分：显示警告信息时可用的按键

- [O]pen Read-Only: 打开此文件成为只读文件
- [E]dit anyway:仍然用正常的方式打开要编辑的那个文件，并不会加载缓存的内容，容易出现两个用户互相改变对方的文件等问题。
- [R]ecover:加载缓存的内容，用在要救回之前未保存的工作，不过当回复完成并且保存退出vim后仍然要手动删除原来的缓存
- [D]elete it:打开文件会先将缓存删除
- [Q]uit:退出vim，不执行任何操作
- [A]bort:和Q类似

### 二、额外功能

- 可视区块

  按下v或V或[Ctrl] + V时，光标移动过的地方会高亮显示

  | 按键                 | 效果                               |
  | -------------------- | ---------------------------------- |
  | v                    | 将光标经过的字符高亮选择           |
  | V                    | 将光标经过的行高亮选择             |
  | **`Ctrl`** + **`v`** | 可视区块，可以用矩形的方式选择数据 |
  | y                    | 将高亮的地方复制                   |
  | d                    | 将高亮的地方删除                   |
  | p                    | 将复制的区块在光标所在处粘贴       |

- 多文件编辑

  先用vim后面接数个文件同时打开

  | 按键   | 效果                          |
  | ------ | ----------------------------- |
  | :n     | 编辑下个文件                  |
  | :N     | 编辑上个文件                  |
  | :files | 列出目前这个vim开启的所有文件 |

- 多窗口

  | 按键                                                         | 功能                                                         |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | :sp [filename]                                               | 打开一个新窗口，若加filename，则显示新文件，否则新窗口同步显示原文件 |
  | **`Ctrl`** + **`w`** + **`j`**<br />**`Ctrl`** + **`w`** + **`⬇`** | 按键方法：先按下ctrl，再按下w，然后放开所有按键，之后再按下第三个按键<br />作用：光标移动到下方的窗口 |
  | **`Ctrl`** + **`w`** + **`k`**<br />**`Ctrl`** + **`w`** + **`⬆`** | 同上，不过光标移动到上一个窗口                               |
  | **`Ctrl`** + **`w`** + **`q`**                               | 相当于:q,退出光标所在的窗口，还可以输入:close关闭当前所在窗口 |

- 关键词补全

  | 组合键                                        | 补齐内容                                                     |
  | --------------------------------------------- | ------------------------------------------------------------ |
  | 先**`Ctrl`** + **`x`** 再**`Ctrl`** + **`n`** | 通过目前正在编辑的文件的内容文字作为关键词，予以不起         |
  | 先**`Ctrl`** + **`x`** 再**`Ctrl`** + **`f`** | 以当前目录内的文件名作为关键词，予以补齐                     |
  | 先**`Ctrl`** + **`x`** 再**`Ctrl`** + **`o`** | 以拓展名作为语法补充，以vim内置的关键词予以补齐（对编写网页文件比较有用） |

- vim环境设置与记录：`~/.vimrc`、`~/.viminfo`

  | 参数                                   | 作用                                                         |
  | -------------------------------------- | ------------------------------------------------------------ |
  | :set nu<br />:set nonu                 | 设置与取消行号                                               |
  | :set hlsearch<br />:set nohlsearch     | high light search高亮查找，设置是否将查找到的字符串高亮显示  |
  | :set autoindent<br />:set noautoindent | 是否自动缩进                                                 |
  | :set backup                            | 是否自动保存备份文件，默认为nobackup，设置后修改文件时源文件会被另存为成名为filename~的文件。 |
  | :set ruler                             | 是否显示右下角的状态栏说明                                   |
  | :set shownmode                         | 是否要显示**--INSERT--**之类的左下角状态栏                   |
  | :set backspace=(012)                   | 退格键的作用，当backspace=2时，可以删除任意值，0或1时，只能删除刚刚输入的字符 |
  | :set all                               | 显示目前所有的环境参数设置值                                 |
  | :set                                   | 显示与系统默认值不同的设置参数                               |
  | :syntax on<br />:syntax off            | 是否依据程序语法显示不同颜色，并自动除错                     |
  | :set bg=dark<br />:set bg=light        | 颜色色调的深浅                                               |

  - 整体vim的参数值位于`/etc/vimrc`，但建议修改`~/.vimrc`，文件中参数名的冒号可以忽略，文件中双引号是注释符号

### 三、其他设置

- 中文编码问题（修改终端的相应配置）

- DOS与Linux的换行符不同

  安装dos2unix即可

  ```
  dos2unix [-kn] file [newfile]
  unix2dos [-kn] file [newfile]
  选项与参数：
  -k:保留源文件的mtime
  -n:保留原本的旧文件，将转换后的内同输出新文件
  ```

- 语系编码转换--iconv

  ```
  iconv --list
  iconv -f 原本编码 -t 新编码 filename [-o newfile]
  选项与参数：
  --list:列出iconv支持语系
  -f:from
  -t:to
  -o file:保留源文件，建立新编码文件newfile
  ```



## 第10章：认识与学习BASH



